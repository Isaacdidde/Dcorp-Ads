{% extends "admin/layout/base_admin.html" %}
{% block content %}

<!-- Modern Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  body, * {
      font-family: "Inter", sans-serif;
  }

  .title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 25px;
      color: #eef3ff;
  }

  .section {
      background: #111827;
      padding: 24px;
      margin-bottom: 28px;
      border-radius: 16px;
      border: 1px solid #1f2937;
      box-shadow: 0 0 12px rgba(0,0,0,0.25);
  }

  .creative-img-wrapper {
    width: 100%;
    height: 320px;
    background: #0f172a;
    border-radius: 14px;
    border: 1px solid #1e293b;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  .creative-img-wrapper img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      object-position: center;
      display: block;
  }

  .status-badge {
      padding: 7px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      display: inline-block;
  }
  .status-pending { background:#ffcf56; color:#000; }
  .status-approved { background:#3ddc84; color:#000; }
  .status-rejected { background:#ef4444; color:#fff; }
  .status-paused { background:#6b7280; color:#fff; }

  .label {
      font-size: 13px;
      color:#9ca3af;
      font-weight: 500;
      margin-bottom: 4px;
  }

  .value {
      font-size: 17px;
      font-weight: 600;
      color:#f3f4f6;
      margin-bottom: 16px;
  }

  .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 18px;
  }

  .metric-box {
      background: #1f2937;
      padding: 18px;
      border-radius: 14px;
      border: 1px solid #374151;
  }

  .metric-title {
      font-size: 13px;
      color:#9ca3af;
      font-weight: 500;
  }

  .metric-value {
      font-size: 22px;
      font-weight: 700;
      margin-top: 6px;
      color:#f3f4f6;
  }

  .admin-btn {
      font-weight: 600;
      padding: 12px 24px;
      border-radius: 10px;
      width: 100%;
      border: none;
      font-size: 15px;
  }

  .approve-btn { background:#3ddc84; color:#000; }
  .reject-btn  { background:#ef4444; color:#fff; }
  .pause-btn   { background:#facc15; color:#000; }
  .resume-btn  { background:#22c55e; color:#000; }

  .perf-btn {
      background:#4f46e5;
      color:#fff;
      font-weight:600;
      padding:12px 20px;
      text-align:center;
      border-radius:10px;
      display:block;
      text-decoration:none;
      margin-bottom:20px;
      transition:0.2s;
  }

  .perf-btn:hover {
      background:#6366f1;
      transform:translateY(-2px);
  }

  /* New tighter layout for admin review */
  .review-textarea {
      background:#0f172a;
      color:#fff;
      border:1px solid #1e293b;
      border-radius:10px;
      padding:12px;
      width:100%;
      resize: vertical;
  }
</style>

{% set safe_budget = c.budget or 0 %}
{% set safe_spend = c.spend or 0 %}
{% set progress = (safe_spend / safe_budget * 100) if safe_budget > 0 else 0 %}
{% set remaining = safe_budget - safe_spend %}

<div class="title">Campaign Details → {{ c.title }}</div>

<div class="row g-4">

    <!-- LEFT COLUMN -->
    <div class="col-lg-8">

        <!-- BASIC INFO -->
        <div class="section">

            <div class="status-badge status-{{ c.status }}">{{ c.status }}</div>

            <h2 style="margin-top:14px; color:white; font-size:24px; font-weight:700;">
                {{ c.title }}
            </h2>

            <p class="label">Product Name</p>
            <p class="value">{{ c.product_name or "Not provided" }}</p>

            <p class="label">Ad Slot</p>
            <p class="value">{{ c.slot_id|replace("_"," ")|title }}</p>

            <p class="label">Redirect URL</p>
            <p class="value">
              {% if c.redirect_url %}
                <a href="{{ c.redirect_url }}" target="_blank" style="color:#818cf8; text-decoration:none;">
                    {{ c.redirect_url }}
                </a>
              {% else %}
                —
              {% endif %}
            </p>

            <p class="label">Start Date</p>
            <p class="value">{{ c.start_date_str }}</p>

            <p class="label">End Date</p>
            <p class="value">{{ c.end_date_str }}</p>

            {% if c.headline %}
            <p class="label">Headline</p>
            <p class="value">{{ c.headline }}</p>
            {% endif %}

            {% if c.description %}
            <p class="label">Description</p>
            <p class="value" style="white-space:pre-line;">{{ c.description }}</p>
            {% endif %}
        </div>

        <!-- CREATIVE -->
        <div class="section">
            <h4 style="color:white; font-size:18px; margin-bottom:16px;">Creative Preview</h4>

            <div class="creative-img-wrapper">
                <img 
                  src="{{ c.creative_image or '/static/defaults/no-image.png' }}"
                  onerror="this.onerror=null; this.src='/static/defaults/no-image.png';"
                  alt="Creative">
            </div>
        </div>

    </div>

    <!-- RIGHT COLUMN -->
    <div class="col-lg-4">

        <!-- PERFORMANCE BUTTON -->
        <a href="/admin/campaign/{{ c._id }}/performance" class="perf-btn">
            View Performance Dashboard →
        </a>

        <!-- ADVERTISER INFO -->
        <div class="section">
            <h4 class="label mb-2" style="font-size:16px;">Advertiser Info</h4>

            <div style="display:flex; gap:14px; align-items:center; margin-top:10px;">
                <img 
                    src="{{ advertiser.profile_pic }}"
                    onerror="this.onerror=null; this.src='/static/image/default_user.png';"
                    style="width:60px; height:60px; border-radius:50%; object-fit:cover;">
                <div>
                    <p class="value">{{ advertiser.name }}</p>
                    <p class="label">{{ advertiser.email }}</p>
                    <p class="label">
                      Joined:
                      {% if advertiser.created_at %}
                        {{ advertiser.created_at.strftime("%d %b %Y") }}
                      {% endif %}
                    </p>
                </div>
            </div>

            <p class="label mt-3">User ID</p>
            <p class="value">{{ advertiser._id }}</p>

            <a href="/admin/users" style="color:#818cf8; text-decoration:none;">View User →</a>
        </div>

        <!-- METRICS -->
        <div class="section">
            <h4 class="label mb-2" style="font-size:16px;">Campaign Metrics</h4>

            <div class="metrics-grid">

                <div class="metric-box">
                    <div class="metric-title">Budget</div>
                    <div class="metric-value">₹{{ safe_budget }}</div>
                </div>

                <div class="metric-box">
                    <div class="metric-title">Spent</div>
                    <div class="metric-value">₹{{ safe_spend }}</div>
                </div>

                <div class="metric-box">
                    <div class="metric-title">Remaining</div>
                    <div class="metric-value">₹{{ remaining }}</div>
                </div>

                <div class="metric-box">
                    <div class="metric-title">Health Score</div>
                    <div class="metric-value">{{ health.score }}%</div>
                </div>

                <div class="metric-box">
                    <div class="metric-title">Pacing</div>
                    <div class="metric-value">{{ pacing.status }}</div>
                </div>

            </div>
        </div>

        <!-- ADMIN REVIEW BOX -->
        {% if c.status == "pending" %}

        <div class="section">

            <h5 class="text-white mb-3">Admin Review</h5>

            <label class="form-label text-white">Rejection Reason</label>

            <textarea name="reason"
                      form="rejectForm"
                      class="review-textarea"
                      placeholder="Enter reason if rejecting..."></textarea>

        </div>

        <!-- BUTTON BLOCK -->
        <div class="section" style="text-align:center;">

            <!-- Approve -->
            <form id="approveForm"
                  action="{{ url_for('admin_panel.approve_campaign', cid=c._id) }}"
                  method="POST" class="mb-3">

                <button type="submit"
                        class="btn btn-success w-100 py-3"
                        style="font-size:18px; border-radius:12px;">
                    Approve Campaign
                </button>
            </form>

            <!-- Reject -->
            <form id="rejectForm"
                  action="{{ url_for('admin_panel.reject_campaign', cid=c._id) }}"
                  method="POST">

                <button type="submit"
                        class="btn btn-danger w-100 py-3"
                        style="font-size:18px; border-radius:12px;">
                    Reject Campaign
                </button>
            </form>

        </div>

        {% endif %}

        {% if c.status == "approved" %}
        <div class="section">
            <form method="POST" action="{{ url_for('admin_panel.pause_campaign', cid=c._id) }}">
                <button class="admin-btn pause-btn">Pause Campaign</button>
            </form>
        </div>
        {% endif %}

        {% if c.status == "paused" %}
        <div class="section">
            <form method="POST" action="{{ url_for('admin_panel.resume_campaign', cid=c._id) }}">
                <button class="admin-btn resume-btn">Resume Campaign</button>
            </form>
        </div>
        {% endif %}

    </div>
</div>

{% endblock %}
