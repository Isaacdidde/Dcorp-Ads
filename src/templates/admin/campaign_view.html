{% extends "admin/layout/base_admin.html" %}
{% block content %}

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  body, * {
      font-family: "Inter", sans-serif;
  }

  .title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 25px;
      color: #eef3ff;
  }

  .section {
      background: #111827;
      padding: 24px;
      margin-bottom: 28px;
      border-radius: 16px;
      border: 1px solid #1f2937;
      box-shadow: 0 0 12px rgba(0,0,0,0.25);
  }

  .creative-img-wrapper {
      width: 100%;
      height: 320px;
      background: #0f172a;
      border-radius: 14px;
      border: 1px solid #1e293b;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
  }

  .creative-img-wrapper img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
  }

  .status-badge {
      padding: 7px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      display: inline-block;
  }

  .status-pending { background:#ffcf56; color:#000; }
  .status-approved { background:#3ddc84; color:#000; }
  .status-rejected { background:#ef4444; color:#fff; }
  .status-paused { background:#6b7280; color:#fff; }

  .label {
      font-size: 13px;
      color:#9ca3af;
      font-weight: 500;
      margin-bottom: 4px;
  }

  .value {
      font-size: 17px;
      font-weight: 600;
      color:#f3f4f6;
      margin-bottom: 16px;
  }

  .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 18px;
  }

  .metric-box {
      background: #1f2937;
      padding: 18px;
      border-radius: 14px;
      border: 1px solid #374151;
  }

  .metric-title {
      font-size: 13px;
      color:#9ca3af;
  }

  .metric-value {
      font-size: 22px;
      font-weight: 700;
      color:#f3f4f6;
  }

  /* Rejection reason spacing */
  /* Make textarea sit inside the card padding properly */
/* Proper padding and positioning for textarea */
.admin-review-box {
    padding-bottom: 30px !important;
}

/* Wrapper ensures textarea never touches the edge */
.review-wrapper {
    padding-right: 4px;     /* keeps right spacing clean */
    padding-top: 6px;
}

/* Textarea styling */
.review-textarea {
    width: 100%;
    display: block;

    background: #0f172a;
    color: #fff;

    border: 1px solid #1e293b;
    border-radius: 10px;

    padding: 16px;
    resize: vertical;

    /* prevents overflow outside card */
    box-sizing: border-box;

    margin-top: 20px;
}



  /* Buttons side by side */
  /* Modern dual action bar */
.action-buttons {
    display: flex;
    justify-content: space-between;
    gap: 18px;
    margin-top: 10px;
}

.action-buttons form {
    flex: 1;
}

/* Button styles — bigger, smoother, aligned */
.action-buttons button {
    width: 100%;
    padding: 14px 0;
    border-radius: 12px;
    font-size: 17px;
    font-weight: 700;
    border: none;
    letter-spacing: 0.3px;
    transition: 0.25s ease;
}

/* Approve */
.btn-approve {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: #000;
    box-shadow: 0 4px 12px rgba(22, 163, 74, 0.35);
}

.btn-approve:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(22, 163, 74, 0.45);
}

/* Reject */
.btn-reject {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.35);
}

.btn-reject:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(239, 68, 68, 0.45);
}

/* Make the whole section look intentional */
.section.action-section {
    padding-top: 34px;
    padding-bottom: 34px;
    text-align: center;
}

</style>

{% set safe_budget = c.budget or 0 %}
{% set safe_spend = c.spend or 0 %}
{% set progress = (safe_spend / safe_budget * 100) if safe_budget > 0 else 0 %}
{% set remaining = safe_budget - safe_spend %}

<div class="title">Campaign Details → {{ c.title }}</div>

<div class="row g-4">

    <!-- LEFT -->
    <div class="col-lg-8">

        <div class="section">
            <div class="status-badge status-{{ c.status }}">{{ c.status }}</div>

            <h2 style="margin-top:14px; color:white; font-size:24px; font-weight:700;">
                {{ c.title }}
            </h2>

            <p class="label">Product Name</p>
            <p class="value">{{ c.product_name or "Not provided" }}</p>

            <p class="label">Ad Slot</p>
            <p class="value">{{ c.slot_id|replace("_"," ")|title }}</p>

            <p class="label">Redirect URL</p>
            <p class="value">
              {% if c.redirect_url %}
                <a href="{{ c.redirect_url }}" target="_blank" style="color:#818cf8;">
                    {{ c.redirect_url }}
                </a>
              {% else %}
                —
              {% endif %}
            </p>

            <p class="label">Start Date</p>
            <p class="value">{{ c.start_date_str }}</p>

            <p class="label">End Date</p>
            <p class="value">{{ c.end_date_str }}</p>

            {% if c.headline %}
            <p class="label">Headline</p>
            <p class="value">{{ c.headline }}</p>
            {% endif %}

            {% if c.description %}
            <p class="label">Description</p>
            <p class="value" style="white-space:pre-line;">{{ c.description }}</p>
            {% endif %}
        </div>

        <div class="section">
            <h4 style="color:white; margin-bottom:16px;">Creative Preview</h4>

            <div class="creative-img-wrapper">
                <img src="{{ c.creative_image or '/static/defaults/no-image.png' }}"
                     onerror="this.onerror=null; this.src='/static/defaults/no-image.png';">
            </div>
        </div>

    </div>

    <!-- RIGHT -->
    <div class="col-lg-4">

        <a href="/admin/campaign/{{ c._id }}/performance"
           class="perf-btn"
           style="display:block; background:#4f46e5; color:white; padding:12px; text-align:center;
                  border-radius:10px; margin-bottom:20px;">
            View Performance Dashboard →
        </a>

        <div class="section">
            <h4 class="label" style="font-size:16px;">Advertiser Info</h4>

            <div style="display:flex; gap:14px; margin-top:10px;">
                <img src="{{ advertiser.profile_pic }}"
                     onerror="this.onerror=null; this.src='/static/image/default_user.png';"
                     style="width:60px; height:60px; border-radius:50%; object-fit:cover;">
                <div>
                    <p class="value">{{ advertiser.name }}</p>
                    <p class="label">{{ advertiser.email }}</p>
                    <p class="label">
                      Joined:
                      {% if advertiser.created_at %}
                        {{ advertiser.created_at.strftime("%d %b %Y") }}
                      {% endif %}
                    </p>
                </div>
            </div>

            <p class="label mt-3">User ID</p>
            <p class="value">{{ advertiser._id }}</p>

            <a href="/admin/users" style="color:#818cf8;">View User →</a>
        </div>

        <div class="section">
            <h4 class="label" style="font-size:16px;">Campaign Metrics</h4>

            <div class="metrics-grid">
                <div class="metric-box">
                    <div class="metric-title">Budget</div>
                    <div class="metric-value">₹{{ safe_budget }}</div>
                </div>

                <div class="metric-box">
                    <div class="metric-title">Spent</div>
                    <div class="metric-value">₹{{ safe_spend }}</div>
                </div>

                <div class="metric-box">
                    <div class="metric-title">Remaining</div>
                    <div class="metric-value">₹{{ remaining }}</div>
                </div>

                <div class="metric-box">
                    <div class="metric-title">Health Score</div>
                    <div class="metric-value">{{ health.score }}%</div>
                </div>

                <div class="metric-box">
                    <div class="metric-title">Pacing</div>
                    <div class="metric-value">{{ pacing.status }}</div>
                </div>
            </div>
        </div>

        {% if c.status == "pending" %}

       <!-- ADMIN REVIEW -->
<div class="section admin-review-box">
    <h5 class="text-white mb-3">Admin Review</h5>

    <label class="form-label text-white">Rejection Reason</label>

    <div class="review-wrapper">
        <textarea name="reason"
                  form="rejectForm"
                  class="review-textarea"
                  placeholder="Enter reason if rejecting..."></textarea>
    </div>
</div>

        <!-- APPROVE / REJECT BUTTONS (IMPROVED) -->
        <div class="section action-section">

    <div class="action-buttons">

        <!-- Approve -->
        <form id="approveForm"
              action="{{ url_for('admin_panel.approve_campaign', cid=c._id) }}"
              method="POST">
            <button type="submit" class="btn-approve">Approve</button>
        </form>

        <!-- Reject -->
        <form id="rejectForm"
              action="{{ url_for('admin_panel.reject_campaign', cid=c._id) }}"
              method="POST">
            <button type="submit" class="btn-reject">Reject</button>
        </form>

    </div>

</div>

        {% endif %}

        {% if c.status == "approved" %}
        <div class="section">
            <form method="POST" action="{{ url_for('admin_panel.pause_campaign', cid=c._id) }}">
                <button class="admin-btn" style="background:#facc15; color:#000;">Pause Campaign</button>
            </form>
        </div>
        {% endif %}

        {% if c.status == "paused" %}
        <div class="section">
            <form method="POST" action="{{ url_for('admin_panel.resume_campaign', cid=c._id) }}">
                <button class="admin-btn" style="background:#22c55e; color:#000;">Resume Campaign</button>
            </form>
        </div>
        {% endif %}

    </div>
</div>

{% endblock %}
