{% extends "admin/layout/base_admin.html" %}

{% block content %}

<style>
  .page-title {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 24px;
    color: #eef3ff;
  }

  /* FILTER BAR */
  .filters {
    display: flex;
    gap: 16px;
    margin-bottom: 24px;
    flex-wrap: wrap;
  }

  .filters input,
  .filters select {
    padding: 11px 14px;
    border-radius: 10px;
    background: #0f1622;
    border: 1px solid #273340;
    color: #d2dcf9;
    font-size: 14px;
  }

  .filters input:focus,
  .filters select:focus {
    outline: none;
    border-color: #7c5cff;
  }


  /* GRID */
  .campaign-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
    gap: 22px;
  }

  /* CARD */
  .campaign-card {
    background: #0d141d;
    padding: 22px;
    border-radius: 16px;
    border: 1px solid #1a2533;
    box-shadow: 0px 8px 22px rgba(0,0,0,0.35);
    transition: 0.25s ease;
  }

  .campaign-card:hover {
    transform: translateY(-5px);
    box-shadow: 0px 12px 30px rgba(0,0,0,0.45);
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 14px;
  }

  /* STATUS BADGES */
  .status {
    padding: 6px 14px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 600;
    text-transform: capitalize;
  }

  .pending  { background: #ffcf56; color:#000; }
  .approved { background: #3ddc84; color:#000; }
  .rejected { background: #ff4d4d; color:#fff; }
  .paused   { background: #738394; color:#fff; }

  /* TITLE */
  .campaign-title {
    font-size: 20px;
    font-weight: 700;
    color: #f1f4ff;
    margin-bottom: 6px;
  }

  /* META INFO */
  .meta-box {
    background: #111a26;
    padding: 14px 16px;
    border-radius: 12px;
    border: 1px solid #1d2836;
    margin-bottom: 16px;
  }

  .meta-item {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    color: #9fb3cc;
    margin-bottom: 6px;
  }

  .meta-value {
    font-weight: 600;
    color: #eaf1ff;
  }

  /* ACTION BUTTONS */
  .actions {
    margin-top: 16px;
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .btn-small {
    padding: 9px 14px;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    text-decoration: none;
    transition: 0.2s ease;
  }

  .view {
    background: #7c5cff;
    color: #fff;
  }
  .view:hover { background: #6345d4; }

  .approve {
    background: #3ddc84;
    color: #000;
  }
  .approve:hover { background: #34c675; }

  .reject {
    background: #ff4d4d;
    color: #fff;
  }
  .reject:hover { background: #e04545; }

</style>


<h2 class="page-title">Campaigns Overview</h2>

<!-- FILTERS -->
<div class="filters">
  <input type="text" id="search" placeholder="Search campaigns by title…">

  <select id="statusFilter">
    <option value="">All Status</option>
    <option value="pending">Pending</option>
    <option value="approved">Approved</option>
    <option value="rejected">Rejected</option>
    <option value="paused">Paused</option>
  </select>
</div>

<!-- CAMPAIGN CARDS -->
<div class="campaign-grid" id="campaignGrid">
  {% for c in campaigns %}
  <div class="campaign-card" data-title="{{ c.title }}" data-status="{{ c.status }}">

    <!-- HEADER -->
    <div class="card-header">
      <span class="status {{ c.status }}">{{ c.status }}</span>
      <span style="opacity:0.6; font-size:13px;">{{ c.created_at_str }}</span>
    </div>

    <!-- TITLE -->
    <div class="campaign-title">{{ c.title }}</div>

    <!-- META BOX -->
    <div class="meta-box">
      <div class="meta-item">
        <span>Budget:</span>
        <span class="meta-value">₹{{ c.budget }}</span>
      </div>

      <div class="meta-item">
        <span>Spend:</span>
        <span class="meta-value">₹{{ c.spend }}</span>
      </div>

      <div class="meta-item">
        <span>User ID:</span>
        <span class="meta-value">{{ c.user_id }}</span>
      </div>

      <div class="meta-item">
        <span>Product:</span>
        <span class="meta-value">{{ c.product_name or 'N/A' }}</span>
      </div>
    </div>

    <!-- ACTIONS -->
    <div class="actions">

      {% if c.status == "pending" %}
      <form method="POST" action="{{ url_for('admin_panel.approve_campaign', cid=c._id) }}">
        <button class="btn-small approve">Approve</button>
      </form>

      <form method="POST" action="{{ url_for('admin_panel.reject_campaign', cid=c._id) }}">
        <button class="btn-small reject">Reject</button>
      </form>
      {% endif %}

      <a href="{{ url_for('admin_panel.view_campaign', cid=c._id) }}" class="btn-small view">View</a>
    </div>

  </div>
  {% endfor %}
</div>


<script>
  const search = document.getElementById("search");
  const filter = document.getElementById("statusFilter");
  const cards = document.querySelectorAll(".campaign-card");

  function applyFilters() {
    const term = search.value.toLowerCase();
    const status = filter.value;

    cards.forEach(card => {
      const title = card.dataset.title.toLowerCase();
      const st = card.dataset.status;

      const matchesSearch = title.includes(term);
      const matchesStatus = !status || st === status;

      card.style.display = matchesSearch && matchesStatus ? "block" : "none";
    });
  }

  search.addEventListener("input", applyFilters);
  filter.addEventListener("change", applyFilters);
</script>

{% endblock %}
